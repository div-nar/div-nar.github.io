<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D. NARENDRA // TRANSMISSION LOG</title>
    <meta name="description" content="Thoughts on tech, startups, and building things.">
    <link rel="stylesheet" href="style.css">
</head>

<body class="writing-page">
    <div class="writing-shell">
        <header class="site-header writing-header">
            <div>
                <h1>TRANSMISSION LOG</h1>
                <div class="header-subhead dim">Field notes on tech, startups, and building things that survive contact with reality.</div>
                <div class="header-nav-row">
                    <a href="index.html">[ HOME ]</a>
                    <a href="bookshelf.html">[ BOOKSHELF ]</a>
                    <a href="https://kwerky.substack.com/" target="_blank">[ OPEN SUBSTACK ]</a>
                </div>
            </div>
        </header>

        <main class="writing-main">
            <section class="writing-feed">
                <div class="article-list" id="articles-container">
                    <div class="article-item loading">
                        <div class="article-title">LOADING_TRANSMISSIONS...</div>
                    </div>
                </div>
                <div class="writing-feed-foot">
                    <a href="https://kwerky.substack.com/" target="_blank">[ VIEW FULL ARCHIVE ]</a>
                </div>
            </section>
        </main>

        <footer class="site-footer">
            <p>// DIVITH NARENDRA // SYSTEM STATUS: ONLINE // 2025 //</p>
        </footer>
    </div>

    <script>
        function extractArticleImage(item) {
            // Match Substack card previews: thumbnail first, then enclosure fallback.
            if (item.thumbnail && /^https?:\/\//i.test(item.thumbnail)) return item.thumbnail;
            if (item.enclosure && item.enclosure.link && /^https?:\/\//i.test(item.enclosure.link)) {
                return item.enclosure.link;
            }
            return '';
        }

        async function loadSubstackPosts() {
            const container = document.getElementById('articles-container');

            try {
                const response = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://kwerky.substack.com/feed');
                const data = await response.json();

                if (data.status === 'ok' && data.items && data.items.length > 0) {
                    container.innerHTML = '';

                    data.items.slice(0, 8).forEach((item, idx) => {
                        const a = document.createElement('a');
                        a.className = 'article-link';
                        a.href = item.link;
                        a.target = '_blank';
                        a.rel = 'noopener noreferrer';

                        const date = new Date(item.pubDate);
                        const formattedDate = date.toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric',
                            year: 'numeric'
                        }).toUpperCase();

                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = item.description || item.content || '';
                        const raw = tempDiv.textContent.trim().replace(/\s+/g, ' ');
                        const description = raw.length > 160 ? raw.substring(0, 160) + '...' : raw;
                        const layoutClass = 'article-row';
                        const imageUrl = extractArticleImage(item);
                        const imageClass = imageUrl ? '' : 'no-image';
                        const safeImageUrl = imageUrl ? imageUrl.replace(/'/g, '%27') : '';
                        const accentStyle = imageUrl ? `style="--accent-image: url('${safeImageUrl}');"` : '';
                        const imageMarkup = imageUrl
                            ? `<div class="article-thumb-wrap"><img class="article-thumb" src="${imageUrl}" alt="${item.title}"></div>`
                            : '';

                        a.innerHTML = `
                            <div class="article-item ${layoutClass} ${imageClass}" ${accentStyle}>
                                <div class="article-meta">
                                    <span class="article-date">${formattedDate}</span>
                                    <span class="article-cta">READ â†—</span>
                                </div>
                                <div class="article-main">
                                    <div class="article-title">${item.title}</div>
                                    <div class="article-desc">${description}</div>
                                </div>
                                ${imageMarkup}
                            </div>
                        `;

                        container.appendChild(a);
                    });

                } else {
                    container.innerHTML = `
                        <a class="article-link" href="https://kwerky.substack.com/" target="_blank">
                            <div class="article-item article-item--all">
                                <div class="article-title">SUBSTACK DIRECT LINK</div>
                                <div class="article-desc">Unable to load feed. Visit Substack directly.</div>
                            </div>
                        </a>
                    `;
                }
            } catch (error) {
                console.error('Error loading Substack posts:', error);
                container.innerHTML = `
                    <a class="article-link" href="https://kwerky.substack.com/" target="_blank">
                        <div class="article-item article-item--all">
                            <div class="article-title">SUBSTACK DIRECT LINK</div>
                            <div class="article-desc">Unable to load feed. Visit Substack directly.</div>
                        </div>
                    </a>
                `;
            }
        }

        loadSubstackPosts();
    </script>
</body>

</html>
